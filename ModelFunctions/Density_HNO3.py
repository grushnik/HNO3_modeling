# -*- coding: utf-8 -*-
"""
Created on Tue May 30 10:24:23 2023

@author: QiRao
"""

import numpy as np
import matplotlib.pyplot as plt
from scipy.interpolate import griddata

def density_HNO3(Wper,Tc):
    '''
    Interpolates mass-density of nitric-acid solution in water
    
    Parameters:
        Wper[] - concentration (0-100) [wt %] 
        Tc[] - temperature (0-100 for Wper<= 63, 5-30 for Wper>63) [C]
    
    Returns:
        rho[] - mass-density [kg/l] (0 if outside allowed parameter range)
    
    Based on: "Perry's Chemical Engineers' Handbook" 
                  by Robert H. Perry, Don Green, Sixth Edition
                  
               https://www.handymath.com/cgi-bin/nitrictble2.cgi?submit=Entry
    '''
            
    # Tabulated density
    
    RR = np.array([\
        [ 0.99989, 0.99993, 0.99965, 0.99906, 0.99819, 0.99705, 0.99567, 0.99225, 0.98805, 0.98319, 0.97176, 0.95837,],
        [ 1.00580, 1.00572, 1.00534, 1.00464, 1.00364, 1.00241, 1.00090, 0.99730, 0.99310, 0.98820, 0.97670, 0.96320,],
        [ 1.01170, 1.01149, 1.01099, 1.01018, 1.00909, 1.00778, 1.00610, 1.00250, 0.99820, 0.99320, 0.98160, 0.96810,],
        [ 1.01760, 1.01730, 1.01668, 1.01576, 1.01457, 1.01318, 1.01140, 1.00770, 1.00330, 0.99820, 0.98650, 0.97300,],
        [ 1.02360, 1.02315, 1.02240, 1.02137, 1.02008, 1.01861, 1.01680, 1.01290, 1.00840, 1.00330, 0.99150, 0.97790,],
        [ 1.02960, 1.02904, 1.02816, 1.02702, 1.02563, 1.02408, 1.02220, 1.01820, 1.01360, 1.00840, 0.99650, 0.98290,],
        [ 1.03570, 1.03497, 1.03397, 1.03272, 1.03122, 1.02958, 1.02770, 1.02350, 1.01880, 1.01360, 1.00150, 0.98790,],
        [ 1.04180, 1.04100, 1.03990, 1.03850, 1.03690, 1.03520, 1.03330, 1.02890, 1.02410, 1.01880, 1.00660, 0.99290,],
        [ 1.04800, 1.04710, 1.04580, 1.04430, 1.04270, 1.04090, 1.03890, 1.03440, 1.02950, 1.02410, 1.01170, 0.99800,],
        [ 1.05430, 1.05320, 1.05180, 1.05020, 1.04850, 1.04660, 1.04460, 1.03990, 1.03490, 1.02940, 1.01690, 1.00320,],
        [ 1.06060, 1.05940, 1.05780, 1.05610, 1.05430, 1.05230, 1.05030, 1.04550, 1.04030, 1.03470, 1.02210, 1.00830,],
        [ 1.06690, 1.06560, 1.06390, 1.06210, 1.06020, 1.05810, 1.05600, 1.05110, 1.04580, 1.04010, 1.02730, 1.01340,],
        [ 1.07330, 1.07180, 1.07000, 1.06810, 1.06610, 1.06400, 1.06180, 1.05670, 1.05130, 1.04550, 1.03260, 1.01860,],
        [ 1.07970, 1.07810, 1.07620, 1.07420, 1.07210, 1.06990, 1.06760, 1.06240, 1.05680, 1.05090, 1.03790, 1.02380,],
        [ 1.08620, 1.08450, 1.08240, 1.08030, 1.07810, 1.07580, 1.07350, 1.06810, 1.06240, 1.05640, 1.04320, 1.02890,],
        [ 1.09270, 1.09090, 1.08870, 1.08650, 1.08420, 1.08180, 1.07940, 1.07390, 1.06800, 1.06190, 1.04850, 1.03410,],
        [ 1.09920, 1.09730, 1.09500, 1.09270, 1.09030, 1.08790, 1.08540, 1.07970, 1.07370, 1.06750, 1.05380, 1.03930,],
        [ 1.10570, 1.10380, 1.10140, 1.09890, 1.09640, 1.09400, 1.09140, 1.08550, 1.07940, 1.07310, 1.05920, 1.04440,],
        [ 1.11230, 1.11030, 1.10780, 1.10520, 1.10260, 1.10010, 1.09740, 1.09130, 1.08510, 1.07870, 1.06460, 1.04960,],
        [ 1.11890, 1.11680, 1.11420, 1.11150, 1.10880, 1.10620, 1.10340, 1.09720, 1.09080, 1.08430, 1.07000, 1.05470,],
        [ 1.12550, 1.12340, 1.12060, 1.11780, 1.11500, 1.11230, 1.10940, 1.10310, 1.09660, 1.08990, 1.07540, 1.05980,],
        [ 1.13220, 1.13000, 1.12710, 1.12420, 1.12130, 1.11850, 1.11550, 1.10900, 1.10240, 1.09560, 1.08080, 1.06500,],
        [ 1.13890, 1.13660, 1.13360, 1.13060, 1.12760, 1.12470, 1.12170, 1.11500, 1.10830, 1.10130, 1.08620, 1.07010,],
        [ 1.14570, 1.14330, 1.14020, 1.13710, 1.13400, 1.13100, 1.12800, 1.12100, 1.11420, 1.10700, 1.09170, 1.07530,],
        [ 1.15250, 1.15010, 1.14690, 1.14370, 1.14040, 1.13740, 1.13430, 1.12710, 1.12010, 1.11270, 1.09720, 1.08050,],
        [ 1.15940, 1.15690, 1.15360, 1.15030, 1.14690, 1.14380, 1.14060, 1.13320, 1.12600, 1.11850, 1.10270, 1.08570,],
        [ 1.16630, 1.16380, 1.16030, 1.15690, 1.15340, 1.15020, 1.14690, 1.13940, 1.13200, 1.12440, 1.10830, 1.09100,],
        [ 1.17330, 1.17070, 1.16700, 1.16350, 1.16000, 1.15660, 1.15330, 1.14560, 1.13810, 1.13030, 1.11390, 1.09630,],
        [ 1.18030, 1.17770, 1.17380, 1.17020, 1.16660, 1.16310, 1.15970, 1.15190, 1.14420, 1.13620, 1.11950, 1.10160,],
        [ 1.18740, 1.18470, 1.18070, 1.17700, 1.17330, 1.16970, 1.16620, 1.15820, 1.15030, 1.14220, 1.12510, 1.10690,],
        [ 1.19450, 1.19170, 1.18760, 1.18380, 1.18000, 1.17630, 1.17270, 1.16450, 1.15640, 1.14820, 1.13070, 1.11220,],
        [ 1.20160, 1.19880, 1.19450, 1.19060, 1.18670, 1.18290, 1.17920, 1.17080, 1.16250, 1.15420, 1.13630, 1.11750,],
        [ 1.20880, 1.20590, 1.20140, 1.19740, 1.19340, 1.18960, 1.18570, 1.17720, 1.16870, 1.16020, 1.14190, 1.12280,],
        [ 1.21600, 1.21310, 1.20840, 1.20430, 1.20020, 1.19630, 1.19220, 1.18360, 1.17490, 1.16620, 1.14760, 1.12810,],
        [ 1.22330, 1.22030, 1.21550, 1.21130, 1.20710, 1.20300, 1.19880, 1.19010, 1.18120, 1.17230, 1.15330, 1.13350,],
        [ 1.23060, 1.22750, 1.22270, 1.21830, 1.21400, 1.20980, 1.20550, 1.19660, 1.18760, 1.17840, 1.15910, 1.13900,],
        [ 1.23750, 1.23440, 1.22940, 1.22490, 1.22050, 1.21630, 1.21190, 1.20280, 1.19360, 1.18420, 1.16450, 1.14400,],
        [ 1.24440, 1.24120, 1.23610, 1.23150, 1.22700, 1.22270, 1.21820, 1.20890, 1.19950, 1.18990, 1.16990, 1.14900,],
        [ 1.25130, 1.24790, 1.24280, 1.23810, 1.23350, 1.22910, 1.22450, 1.21500, 1.20540, 1.19560, 1.17520, 1.15400,],
        [ 1.25810, 1.25460, 1.24940, 1.24460, 1.23990, 1.23540, 1.23080, 1.22100, 1.21120, 1.20130, 1.18050, 1.15890,],
        [ 1.26490, 1.26130, 1.25600, 1.25110, 1.24630, 1.24170, 1.23700, 1.22700, 1.21700, 1.20690, 1.18580, 1.16380,],
        [ 1.27170, 1.26800, 1.26260, 1.25760, 1.25270, 1.24800, 1.24320, 1.23300, 1.22290, 1.21260, 1.19110, 1.16870,],
        [ 1.27860, 1.27470, 1.26920, 1.26410, 1.25910, 1.25430, 1.24940, 1.23900, 1.22870, 1.21820, 1.19630, 1.17350,],
        [ 1.28540, 1.28140, 1.27580, 1.27060, 1.26550, 1.26060, 1.25560, 1.24500, 1.23450, 1.22380, 1.20150, 1.17830,],
        [ 1.29220, 1.28800, 1.28240, 1.27710, 1.27190, 1.26690, 1.26180, 1.25100, 1.24030, 1.22940, 1.20670, 1.18310,],
        [ 1.29900, 1.29470, 1.28900, 1.28360, 1.27830, 1.27320, 1.26800, 1.25700, 1.24610, 1.23500, 1.21190, 1.18790,],
        [ 1.30580, 1.30140, 1.29550, 1.29010, 1.28470, 1.27950, 1.27420, 1.26300, 1.25190, 1.24060, 1.21710, 1.19270,],
        [ 1.31260, 1.30800, 1.30210, 1.29660, 1.29110, 1.28580, 1.28040, 1.26900, 1.25770, 1.24620, 1.22230, 1.19760,],
        [ 1.31940, 1.31470, 1.30870, 1.30310, 1.29750, 1.29210, 1.28670, 1.27500, 1.26350, 1.25180, 1.22750, 1.20240,],
        [ 1.32630, 1.32140, 1.31530, 1.30960, 1.30400, 1.29840, 1.29290, 1.28110, 1.26930, 1.25750, 1.23280, 1.20730,],
        [ 1.33270, 1.32770, 1.32150, 1.31570, 1.31000, 1.30430, 1.29870, 1.28670, 1.27480, 1.26280, 1.23770, 1.21180,],
        [ 1.33910, 1.33390, 1.32770, 1.32180, 1.31600, 1.31020, 1.30450, 1.29230, 1.28020, 1.26800, 1.24250, 1.21630,],
        [ 1.34540, 1.34010, 1.33380, 1.32780, 1.32190, 1.31600, 1.31020, 1.29780, 1.28560, 1.27310, 1.24730, 1.22080,],
        [ 1.35170, 1.34620, 1.33990, 1.33380, 1.32780, 1.32180, 1.31590, 1.30330, 1.29090, 1.27820, 1.25210, 1.22520,],
        [ 1.35790, 1.35230, 1.34590, 1.33970, 1.33360, 1.32750, 1.32150, 1.30870, 1.29610, 1.28330, 1.25680, 1.22960,],
        [ 1.36400, 1.35830, 1.35180, 1.34550, 1.33930, 1.33310, 1.32700, 1.31410, 1.30130, 1.28830, 1.26150, 1.23390,],
        [ 1.37000, 1.36420, 1.35760, 1.35120, 1.34490, 1.33860, 1.33240, 1.31940, 1.30640, 1.29320, 1.26610, 1.23820,],
        [ 1.37590, 1.37000, 1.36340, 1.35690, 1.35050, 1.34410, 1.33770, 1.32460, 1.31140, 1.29810, 1.27060, 1.24240,],
        [ 1.38180, 1.37570, 1.36910, 1.36250, 1.35600, 1.34950, 1.34300, 1.32980, 1.31640, 1.30290, 1.27510, 1.24660,],
        [ 1.38750, 1.38130, 1.37470, 1.36800, 1.36140, 1.35480, 1.34820, 1.33480, 1.32130, 1.30770, 1.27950, 1.25070,],
        [ 1.39310, 1.38680, 1.38010, 1.37340, 1.36670, 1.36000, 1.35330, 1.33980, 1.32610, 1.31240, 1.28390, 1.25470,],
        [ 1.39860, 1.39220, 1.38550, 1.37870, 1.37190, 1.36510, 1.35830, 1.34470, 1.33080, 1.31690, 1.28810, 1.25870,],
        [ 1.40390, 1.39750, 1.39070, 1.38380, 1.37690, 1.37000, 1.36320, 1.34940, 1.33540, 1.32130, 1.29220, 1.26250,],
        [ 1.40910, 1.40270, 1.39580, 1.38880, 1.38180, 1.37480, 1.36790, 1.35400, 1.33980, 1.32550, 1.29620, 1.26610,],
        [ 0.00000, 1.40780, 1.40070, 1.39360, 1.38660, 1.37950, 1.37250, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.41280, 1.40550, 1.39840, 1.39130, 1.38410, 1.37700, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.41770, 1.41030, 1.40310, 1.39590, 1.38870, 1.38140, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.42240, 1.41500, 1.40770, 1.40040, 1.39320, 1.38570, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.42710, 1.41960, 1.41220, 1.40480, 1.39760, 1.39000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.43170, 1.42410, 1.41660, 1.40910, 1.40190, 1.39420, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.43620, 1.42850, 1.42100, 1.41340, 1.40610, 1.39830, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.44060, 1.43280, 1.42520, 1.41760, 1.41020, 1.40230, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.44490, 1.43710, 1.42940, 1.42180, 1.41420, 1.40630, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.44910, 1.44130, 1.43350, 1.42580, 1.41820, 1.41030, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.45320, 1.44540, 1.43760, 1.42980, 1.42210, 1.41420, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.45730, 1.44940, 1.44150, 1.43370, 1.42590, 1.41800, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.46130, 1.45330, 1.44540, 1.43750, 1.42960, 1.42170, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.46520, 1.45720, 1.44920, 1.44130, 1.43330, 1.42530, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.46900, 1.46100, 1.45290, 1.44500, 1.43690, 1.42880, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.47270, 1.46470, 1.45650, 1.44860, 1.44040, 1.43230, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.47640, 1.46830, 1.46010, 1.45210, 1.44390, 1.43570, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.48000, 1.47180, 1.46360, 1.45550, 1.44730, 1.43910, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.48350, 1.47530, 1.46700, 1.45890, 1.45070, 1.44240, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.48690, 1.47870, 1.47040, 1.46220, 1.45400, 1.44560, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.49030, 1.48200, 1.47370, 1.46550, 1.45720, 1.44870, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.49360, 1.48520, 1.47690, 1.46860, 1.46030, 1.45180, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.49680, 1.48830, 1.47990, 1.47160, 1.46330, 1.45480, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.49990, 1.49130, 1.48290, 1.47450, 1.46620, 1.45770, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.50290, 1.49420, 1.48580, 1.47730, 1.46900, 1.46050, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.50580, 1.49700, 1.48850, 1.48000, 1.47160, 1.46310, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.50850, 1.49970, 1.49110, 1.48260, 1.47410, 1.46560, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.51110, 1.50230, 1.49360, 1.48500, 1.47660, 1.46810, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.51360, 1.50480, 1.49600, 1.48730, 1.47890, 1.47040, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.51560, 1.50680, 1.49790, 1.48920, 1.48070, 1.47220, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.51770, 1.50880, 1.49990, 1.49120, 1.48260, 1.47410, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.51980, 1.51090, 1.50190, 1.49320, 1.48460, 1.47610, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.52200, 1.51300, 1.50400, 1.49520, 1.48670, 1.47810, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.52440, 1.51520, 1.50620, 1.49740, 1.48890, 1.48020, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.52780, 1.51870, 1.50960, 1.50080, 1.49220, 1.48350, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.53270, 1.52350, 1.51440, 1.50560, 1.49690, 1.48810, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,],
        [ 0.00000, 1.54020, 1.53100, 1.52170, 1.51290, 1.50400, 1.49520, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000,]])
    
    # Table coordinates
    
    W_table = np.linspace(0,100,101)  # Concentration in %
    T_table = np.array([0,5,10,15,20,25,30,40,50,60,80,100])  # Temperature in degrees C
    WW,TT = np.meshgrid(W_table,T_table,indexing='ij')
    
    # Indentify all points outside allowed range
    
    indx_out = (Wper < 0.) | (Wper > 100.) | (Tc < 0.) | (Tc > 100.) | ((Wper > 63.) & ((Tc < 5.) | (Tc > 30.)))
    indx_in = np.logical_not(indx_out)
      
    # Interpolate
    
    N,M = np.shape(RR)
    Wx = np.reshape(WW,N*M)
    Tx = np.reshape(TT,N*M)
    Rx = np.reshape(RR,N*M)
    
    R = griddata((Wx,Tx), Rx, ([Wper[indx_in]],[Tc[indx_in]]), method='linear')
    R = R[0][:]
    
    rho = np.zeros(np.shape(Wper))
    rho[indx_in] = R

    return rho

if __name__ == "__main__":
    W = np.array([100.,100.])
    T = np.array([30.,30.01])
    rho = density_HNO3(W,T)
    print(rho, np.shape(rho), T)
    
    Ts = np.linspace(0.,100.,100)

    Ws = 0*np.ones(np.shape(Ts))
    plt.plot(Ts,density_HNO3(Ws,Ts))
    
    Ws = 63*np.ones(np.shape(Ts))
    plt.plot(Ts,density_HNO3(Ws,Ts))
    
    Ws = 100*np.ones(np.shape(Ts))
    plt.plot(Ts,density_HNO3(Ws,Ts))
    
    plt.legend(['0%','63%','100%'])

    plt.draw()